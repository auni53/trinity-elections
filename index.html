<!doctype HTML5>

<html>
  <head>

    <title>Trinity Elections 2016</title>
    <meta name='viewport' content='width=device-width, initial-scale=1' charset='utf-8' />

    <link rel='stylesheet' type='text/css' href='stylesheet.css'>
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
    <link rel='stylesheet' href='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css'>

    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js'></script>
    <script src='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js'></script>

  </head>
  <body>

    <div class='container'>
      <h1>Trinity Elections 2016</h1>
      <h2>Week 2 Results</h2>
      <p class='ugh'>THIS TOOK ME FOUR HOURS TO MAKE AND IT'S 5:30 AM WHY DID I DO THIS</p>
      <hr/>

      <!--div class='dump'>
      </div-->

      <div class='panel-group' id='accordion'>

      </div>

    </div>

    <script>
      $( document ).ready(function() {
        $.ajax({
          url : 'https://raw.githubusercontent.com/auni53/trinity-elections/gh-pages/data.json',
          dataType : 'json',
          success : function(result) {
            $( '.dump' ).append(create(result));
          },
          error : function() { console.log('ERROR'); debugger; }
        });
      });

      function getWinner(table) {
        let i;
        for (let name in table) {
          i = table[name].length - 1;
        }
        let max = 0;
        let winner;
        for (let name in table) {
          if (table[name][i] > max) {
            max = table[name][i];
            winner = name;
          }
        }
        return winner;
      }

      function getCount(table) {
        let i;
        for (let name in table) {
          i = table[name].length - 1;
        }
        let count = 0;
        for (let name in table) {
          if (table[name][i] != '*') {
            count += table[name][i];
          }
        }
        return count;
      }

      function create(data) {

        let positions = Object.keys(data).sort()

        // Load a position into the page
        for (let i in positions) {
          text = '';
          let position = positions[i];

          // Create header and table
          // text += '<h3>' + position + '</h3>';
          let header = position;
          text += '<table class="pure-table pure-table-horizontal"><thead><tr><th>Round</th>';

          let table = data[position];
          let length = table['Reopen Nominations'].length;
          let winner = getWinner(table);

          // Create table header
          for (let name in table) {
            text += '<th>' + name + '</th>'
          } text += '</tr></thead><tbody>';

          // Generate table rows
          // debugger;
          let c = 0;
          while (c < length) {
            text += '<td><b>' + (c + 1) + '</b></td>';
            for (let name in table) {
              text += '<td' + (name == winner ? ' class="winner"' : '') + '>' + table[name][c] + '</td>'
            } text += '</tr>';
            c++;
          };
          text += '</tbody></table>'; //<hr/>';

          let target = header;
          target = target.split(' ').join('');
          target = target.split('-').join('');
          target = target.split('#').join('');
          target = target.split('(').join('');
          target = target.split(')').join('');

          let panel = (
            "<div class='panel panel-default'>\
              <div class='panel-heading'>\
                <h4 class='panel-title'>\
                  <a data-toggle='collapse' data-target='#" + target + "'>"
                    + header +
                  "</a>\
                </h4>\
              </div>\
              <div id='" + target + "' class='collapse'>\
                <div class='panel-body'>"
                   + text + '<br/>Final Count: <strong>' + getCount(table) + '</strong>' +
                "</div>\
              </div>\
            </div>"
          );
          $( '.panel-group' ).append(panel);
        }

    }

    </script>
  </body>
</html>
